<!DOCTYPE HTML>
<html>
    <head>
        <title>"3 color led" driving page</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" type="text/css" href="../style.css">
        <script language="javascript" src="../jsapi/api.js"></script>
    </head>
    <body>
        <div id="onDisconnected">
            <h1>Waiting for server datas...</h1>
        </div>
        <div class="block" id="onConnected">
            <iframe id="iframe" src="../" onload="javascript:answer()">Your browser does not support IFrames.</iframe>
            <button onclick="javascript:check()">Check connection</button>
            <div id="colorchooser"></div>
            <div></div><button onclick="javascript:sendRGB()">Send !</button></div>
            <script type="text/javascript">
                
                setupColorChooser();
                init();
                loaded();

                var r;
                var g;
                var b;

                function sendRGB(){
                    
                    r = parseInt(r);
                    g = parseInt(g);
                    b = parseInt(b);

                    var r2;
                    var g2;
                    var b2;

                    if(r < 10){
                        r2 = '00'+r;
                    }else if(r < 100){
                        r2 = '0'+r;
                    }else{
                        r2 = r;
                    }

                    if(g < 10){
                        g2 = '00'+g;
                    }else if(g < 100){
                        g2 = '0'+g;
                    }else{
                        g2 = g;
                    }

                    if(b < 10){
                        b2 = '00'+b;
                    }else if(b < 100){
                        b2 = '0'+b;
                    }else{
                        b2 = b;
                    }
                    
                    send(getHardwareByName('3 color led').PORT + '&a=SET '+r2+' '+g2+' '+b2);
                    
                }

                function setupColorChooser(){

                    r = 60;
                    g = 60;
                    b = 60;

                    var showCanvas = document.createElement('canvas');
                    showCanvas.width = 50;
                    showCanvas.height = 50;
                    showCanvas.style.border = '3px solid black';

                    function drawShow(){

                        var ctx = showCanvas.getContext("2d");
                        ctx.fillStyle = 'rgb('+r+','+g+','+b+')';
                        ctx.fillRect(0,0,50,50);
                        ctx.stroke();

                    }

                    drawShow();

                    var rgCanvas = document.createElement('canvas');
                    rgCanvas.width = 256;
                    rgCanvas.height = 256;
                    rgCanvas.style.border = '3px solid black';

                    function drawRG(){

                        for (var g = 0; g < 256; g++){

                            for (var r = 0; r < 256; r++){

                                var context = rgCanvas.getContext('2d');
                                context.beginPath();
                                context.moveTo(r,g);
                                context.strokeStyle = 'rgb('+r+','+g+','+b+')';
                                context.lineTo(r+1,g+1);
                                context.stroke();
                                context.closePath();

                            }

                        }

                    }

                    drawRG();

                    var bCanvas = document.createElement('canvas');
                    bCanvas.width = 20;
                    bCanvas.height = 256;
                    bCanvas.style.border = '3px solid black';

                    for (b = 0; b < 256; b++){

                        var context = bCanvas.getContext('2d');
                        context.beginPath();
                        context.moveTo(0,b);
                        context.strokeStyle = 'rgb(0, 0, ' + b + ')';
                        context.lineTo(20, b);
                        context.stroke();
                        context.closePath();

                    }

                    function mouseRG(e){

                        var x;
                        var y;
                        if (e.pageX || e.pageY) { 
                          x = e.pageX;
                          y = e.pageY;
                        }
                        else { 
                          x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft; 
                          y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop; 
                        } 
                        x -= rgCanvas.offsetLeft;
                        y -= rgCanvas.offsetTop;

                        var color = rgCanvas.getContext('2d').getImageData(x, y, 1, 1).data;

                        r = color[0];
                        g = color[1];
                        b = color[2];

                        drawShow();

                    }

                    function mouseB(e){

                        var x;
                        var y;
                        if (e.pageX || e.pageY) { 
                          x = e.pageX;
                          y = e.pageY;
                        }
                        else { 
                          x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft; 
                          y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
                        } 
                        x -= bCanvas.offsetLeft;
                        y -= bCanvas.offsetTop;

                        var color = bCanvas.getContext('2d').getImageData(x, y, 1, 1).data;
                        b = color[2];

                        drawRG();
                        drawShow();

                    }

                    rgCanvas.addEventListener('mousedown', mouseRG, false);
                    bCanvas.addEventListener('mousedown', mouseB, false);

                    document.getElementById('colorchooser').appendChild(rgCanvas);
                    document.getElementById('colorchooser').appendChild(bCanvas);
                    document.getElementById('colorchooser').appendChild(showCanvas);

                }

            </script>
        </div>
    </body>
</html>
